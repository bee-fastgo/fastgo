<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bee.team.fastgo.mapper.ProjectDoMapperExt">

    <!--查询后台项目条数-->
    <select id="queryBackProjectTotal" parameterType="map" resultType="java.lang.Integer">
        select count(1) from t_project where projectType = '2'
        <if test="projectName!=null and projectName!=''">
            and projectName like #{projectName}
        </if>
        <if test="projectStatus!=null and projectStatus!=''">
            and projectStatus = #{projectStatus}
        </if>
    </select>

    <!--查询前台项目条数-->
    <select id="queryFrontProjectTotal" parameterType="map" resultType="java.lang.Integer">
        select count(1) from t_project where projectType = '1'
        <if test="projectName!=null and projectName!=''">
            and projectName like #{projectName}
        </if>
        <if test="projectStatus!=null and projectStatus!=''">
            and projectStatus = #{projectStatus}
        </if>
    </select>

    <!--查询后台项目列表-->
    <select id="findBackPorjectList" parameterType="map" resultType="com.bee.team.fastgo.vo.project.ProjectListVo">
        select id,projectName,projectCode,projectDesc,gitUrl,projectStatus,packageName,autoDeploy from t_project where projectType = '2'
        <if test="projectName!=null and projectName!=''">
            and projectName like #{projectName}
        </if>
        <if test="projectStatus!=null and projectStatus!=''">
            and projectStatus = #{projectStatus}
        </if>
        order By gmt_create desc
        limit #{start},#{limit}
    </select>

    <!--查询前台项目列表-->
    <select id="findFrontPorjectList" parameterType="map" resultType="com.bee.team.fastgo.vo.project.ProjectListVo">
        select id,projectName,projectCode,projectDesc,gitUrl,projectStatus,packageName,autoDeploy from t_project where projectType = '1'
        <if test="projectName!=null and projectName!=''">
            and projectName like #{projectName}
        </if>
        <if test="projectStatus!=null and projectStatus!=''">
            and projectStatus = #{projectStatus}
        </if>
        order By gmt_create desc
        limit #{start},#{limit}
    </select>

    <!--查询项目信息-->
    <select id="queryProjectInfo" parameterType="map" resultType="com.bee.team.fastgo.model.ProjectDo">
        select * from t_project p
        inner join t_project_profile pp on p.projectCode = pp.projectCode
        where pp.profileCode = #{code}
    </select>

    <!--查询部署所需项目信息-->
    <select id="findDeployProjectInfo" parameterType="java.lang.String" resultType="com.bee.team.fastgo.vo.project.DeployInfoVo">
        select p.projectName,p.gitUrl,pr.runServerIp as serviceIp,pr.runProfileConfig from t_project p
        inner join t_project_profile pp on p.projectCode = pp.projectCode
        inner join t_profile_runprofile_relation pr on pr.profileCode = pp.profileCode
        where p.projectCode = #{projectCode}
    </select>

    <!--获取项目配置中心code-->
    <select id="findProjectConfigCode" parameterType="map" resultType="java.lang.String">
        select tpcr.configCode from t_profile_config_relation tpcr
        inner join t_project_profile pp on pp.profileCode = tpcr.profileCode
        where pp.projectCode = #{projectCode} and pp.branchName = #{branchName}
    </select>

    <!--查询项目运行环境-->
    <select id="findProjectAccessAddr" parameterType="java.lang.String" resultType="com.bee.team.fastgo.vo.project.ProjectBranchAndAccessAddrVo">
        select pr.runProfileConfig,pp.branchName from t_project_profile pp
        inner join t_project p on p.projectCode = pp.projectCode
        inner join t_profile_runprofile_relation pr on pp.profileCode = pr.profileCode
        where p.projectCode = #{projectCode}
    </select>


</mapper>